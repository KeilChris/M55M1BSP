<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RTX Kernel Tick Timer Configuration</title>
<title>CMSIS-RTOS: RTX Kernel Tick Timer Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="cmsis.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="cmsis_footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="CMSIS_Logo_Final.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CMSIS-RTOS
   &#160;<span id="projectnumber">Version 1.03</span>
   </div>
   <div id="projectbrief">Real-Time Operating System: API and RTX Reference Implementation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('timerTick.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">RTX Kernel Tick Timer Configuration </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The CMSIS-RTOS RTX functions provide delays in units of milliseconds that are derived from the RTX Timer Tick. It is therefore recommended to configure the RTX Timer Tick to generate a 1 millisecond interval. Configuring a longer RTX Timer Tick may reduce energy consumption, but has impacts on the granularity of the timeouts.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">#define   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Use Cortex-M SysTick timer as RTX Kernel Timer   </td><td class="markdownTableBodyNone"><code>OS_SYSTICK</code>   </td><td class="markdownTableBodyNone">Selects the Cortex-M SysTick timer as RTX kernel timer. In this case, the RTX kernel configures the SysTick timer clock source as processor clock. Therefore the value <b>OS_CLOCK</b> should be identical with the value of the CMSIS variable <b>SystemCoreClock</b>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">RTOS Kernel Timer input clock frequency [Hz]   </td><td class="markdownTableBodyNone"><code>OS_CLOCK</code>   </td><td class="markdownTableBodyNone">Specifies the Cortex-M processor clock frequency in Hz. This value is used to calculate the RTX kernel timer reload value.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RTX Timer tick interval value [us]   </td><td class="markdownTableBodyNone"><code>OS_TICK</code>   </td><td class="markdownTableBodyNone">Specifies the RTX Timer Tick interval in microseconds (us). This value is used to calculate timeout values. When the SysTick core timer is enabled the value is also used to configure the SysTick timer. It is recommended to configure the RTX Timer tick to 1000 us which results in a timeout granularity of 1 millisecond.   </td></tr>
</table>
<h1><a class="anchor" id="AltTimer"></a>
Usage of an Alternate Timer as RTX Kernel Timer</h1>
<p>With <b>#define OS_SYSTICK 0</b> an alternative timer is selected as RTX kernel timer.</p>
<p>Four functions in the <a class="el" href="dirstructfiles.html#RTX_Conf_CM">RTX_Conf_CM.c</a> file need to be adapted for using an alternative hardware timer.</p>
<ul>
<li><a class="el" href="group__RTX__Global__Functions.html#ga145e7eafdd042bb522020cbb3b469d9c">os_tick_init</a> provides the initialization function for the alternative hardware timer.</li>
<li><a class="el" href="group__RTX__Global__Functions.html#ga567543bf38239a91f09751686c23017b">os_tick_val</a> returns the current value of the alternative hardware timer.</li>
<li><a class="el" href="group__RTX__Global__Functions.html#gad5deddec3fea0fb31798f571afc3c692">os_tick_ovf</a> returns the overflow flag of the alternative hardware timer.</li>
<li><a class="el" href="group__RTX__Global__Functions.html#ga85dab8408f27236c7341a69feb6258c7">os_tick_irqack</a> is an interrupt acknowledge function that is called to confirm the alternative hardware timer interrupt.</li>
<li><a class="el" href="timerTick.html#OS_Tick_Handler">OS_Tick_Handler</a> needs to be called as the hardware timer interrupt function; the startup code should be modified to this function.</li>
</ul>
<p><b>Configuration Code:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#if (OS_SYSTICK == 0)   </span><span class="comment">// Functions for alternative timer as RTX kernel timer</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*--------------------------- os_tick_init ----------------------------------*/</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Initializes an alternative hardware timer as RTX kernel timer</span></div>
<div class="line"><span class="comment">/// \return                             IRQ number of the alternative hardware timer</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">int</span> <a class="code hl_function" href="group__RTX__Global__Functions.html#ga145e7eafdd042bb522020cbb3b469d9c">os_tick_init</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordflow">return</span> (-1);  <span class="comment">/* Return IRQ number of timer (0..239) */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*--------------------------- os_tick_val -----------------------------------*/</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Get alternative hardware timer&#39;s current value (0 .. OS_TRV)</span></div>
<div class="line"><span class="comment">/// \return                             Current value of the alternative hardware timer</span></div>
<div class="line"><span class="comment"></span>uint32_t <a class="code hl_function" href="group__RTX__Global__Functions.html#ga567543bf38239a91f09751686c23017b">os_tick_val</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*--------------------------- os_tick_ovf -----------------------------------*/</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Get alternative hardware timer&#39;s  overflow flag</span></div>
<div class="line"><span class="comment">/// \return                             Overflow flag\n</span></div>
<div class="line"><span class="comment">///                                     - 1 : overflow</span></div>
<div class="line"><span class="comment">///                                     - 0 : no overflow</span></div>
<div class="line"><span class="comment"></span>uint32_t <a class="code hl_function" href="group__RTX__Global__Functions.html#gad5deddec3fea0fb31798f571afc3c692">os_tick_ovf</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*--------------------------- os_tick_irqack --------------------------------*/</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Acknowledge alternative hardware timer interrupt</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> <a class="code hl_function" href="group__RTX__Global__Functions.html#ga85dab8408f27236c7341a69feb6258c7">os_tick_irqack</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">/* ... */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif   </span><span class="comment">// (OS_SYSTICK == 0)</span></div>
<div class="ttc" id="agroup__RTX__Global__Functions_html_ga145e7eafdd042bb522020cbb3b469d9c"><div class="ttname"><a href="group__RTX__Global__Functions.html#ga145e7eafdd042bb522020cbb3b469d9c">os_tick_init</a></div><div class="ttdeci">int os_tick_init(void)</div><div class="ttdoc">Initializes an alternative hardware timer as RTX kernel timer.</div><div class="ttdef"><b>Definition:</b> RTX_Conf_CM.c:229</div></div>
<div class="ttc" id="agroup__RTX__Global__Functions_html_ga567543bf38239a91f09751686c23017b"><div class="ttname"><a href="group__RTX__Global__Functions.html#ga567543bf38239a91f09751686c23017b">os_tick_val</a></div><div class="ttdeci">uint32_t os_tick_val(void)</div><div class="ttdoc">Get alternative hardware timer's current value (0 .. OS_TRV)</div><div class="ttdef"><b>Definition:</b> RTX_Conf_CM.c:237</div></div>
<div class="ttc" id="agroup__RTX__Global__Functions_html_ga85dab8408f27236c7341a69feb6258c7"><div class="ttname"><a href="group__RTX__Global__Functions.html#ga85dab8408f27236c7341a69feb6258c7">os_tick_irqack</a></div><div class="ttdeci">void os_tick_irqack(void)</div><div class="ttdoc">Acknowledge alternative hardware timer interrupt.</div><div class="ttdef"><b>Definition:</b> RTX_Conf_CM.c:254</div></div>
<div class="ttc" id="agroup__RTX__Global__Functions_html_gad5deddec3fea0fb31798f571afc3c692"><div class="ttname"><a href="group__RTX__Global__Functions.html#gad5deddec3fea0fb31798f571afc3c692">os_tick_ovf</a></div><div class="ttdeci">uint32_t os_tick_ovf(void)</div><div class="ttdoc">Get alternative hardware timer's overflow flag.</div><div class="ttdef"><b>Definition:</b> RTX_Conf_CM.c:247</div></div>
</div><!-- fragment --><p><a class="anchor" id="OS_Tick_Handler"></a></p>
<h2><a class="anchor" id="autotoc_md1"></a>
OS_Tick_Handler</h2>
<p>The function <b>OS_Tick_Handler</b> handles the RTX tick interval interrupts. It is used if you are using an alternate timer as the RTX tick timer.</p>
<p>The <b>OS_Tick_Handler</b> is an interrupt handler function, which runs the OS task scheduler. It is called by the Nested Vectored Interrupt Controller (NVIC) on the alternate timer's interrupt, and cannot be called as a regular C-function. It must be entered into the Interrupt Table in startup file. The default Cortex-M interrupt vector must be replaced by <b>OS_Tick_Handler</b>.</p>
<div class="fragment"><div class="line">; Vector Table Mapped to Address 0 at Reset</div>
<div class="line"> </div>
<div class="line">                AREA    RESET, DATA, READONLY</div>
<div class="line">                EXPORT  __Vectors</div>
<div class="line"> </div>
<div class="line">                IMPORT  OS_Tick_Handler</div>
<div class="line"> </div>
<div class="line">__Vectors       DCD     __initial_sp              ; Top of Stack</div>
<div class="line">                DCD     Reset_Handler             ; Reset Handler</div>
<div class="line">                DCD     NMI_Handler               ; NMI Handler</div>
<div class="line">                DCD     HardFault_Handler         ; Hard Fault Handler</div>
<div class="line">                DCD     MemManage_Handler         ; MPU Fault Handler</div>
<div class="line">                DCD     BusFault_Handler          ; Bus Fault Handler</div>
<div class="line">                DCD     UsageFault_Handler        ; Usage Fault Handler</div>
<div class="line">                DCD     0                         ; Reserved</div>
<div class="line">                DCD     0                         ; Reserved</div>
<div class="line">                DCD     0                         ; Reserved</div>
<div class="line">                DCD     0                         ; Reserved</div>
<div class="line">                DCD     SVC_Handler               ; SVC Handler</div>
<div class="line">                DCD     DebugMon_Handler          ; Debug Monitor Handler</div>
<div class="line">                DCD     0                         ; Reserved</div>
<div class="line">                DCD     PendSV_Handler            ; PendSV Handler</div>
<div class="line">                DCD     SysTick_Handler           ; SysTick Handler</div>
<div class="line"> </div>
<div class="line">                ; External Interrupts</div>
<div class="line">                DCD     WDT_IRQHandler            ; 16: Watchdog Timer</div>
<div class="line">                DCD     TIMER0_IRQHandler         ; 17: Timer0</div>
<div class="line">                ...</div>
<div class="line">                DCD     I2S_IRQHandler            ; 43: I2S</div>
<div class="line">                DCD     ENET_IRQHandler           ; 44: Ethernet</div>
<div class="line">                DCD     OS_Tick_Handler           ; 45: Repetitive Interrupt Timer</div>
<div class="line">                DCD     MCPWM_IRQHandler          ; 46: Motor Control PWM</div>
<div class="line">                ...</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">CMSIS-RTOS</a></li><li class="navelem"><a class="el" href="rtxImplementation.html">RTX Implementation</a></li><li class="navelem"><a class="el" href="configure.html">Configure RTX</a></li>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script>    
    </li>
  </ul>
</div>
</body>
</html>
